@inject Services.TrackerBrain Brain

<div class="tracker-container @BackgroundClass">
    <div class="skill-name @ThemeClass">@SkillName</div>
    
    <div class="level-container">
        <div class="level-xp-text">
            <span class="level-text @ThemeClass">Level @Level</span>
            <span class="xp-text">@CurrentXp/@_threshold XP</span>
        </div>
        
        <div class="progress-track-bar">
            <div class="progress-fill-bar @BarClass" style="width: @(CurrentXp < _threshold ? (CurrentXp / _threshold * 100) : 100)%"></div>
        </div>
        
        <div class="level-input-buttons">
            <input type="number" class="xp-input" placeholder="Minutes" min="0" @bind="_minutesSpent"/>
            <div class="append-xp-btn" @onclick="AppendXp" >APPEND</div>
            <div class="level-up-btn @CanLevelUp()" @onclick="LevelUp">LEVEL UP!</div>
        </div>
    </div>
    
    
</div>

@code {

    [Parameter]
    public string SkillName { get; set; }
    
    [Parameter]
    public string ThemeClass { get; set; }
    
    [Parameter]
    public string BackgroundClass { get; set; }
    
    [Parameter]
    public string BarClass { get; set; }
    
    [Parameter]
    public double CurrentXp { get; set; }
    
    [Parameter]
    public int Level { get; set; }
    
    [Parameter]
    public int Streak { get; set; }
    
    ////////////////////////////////////////////////

    protected override void OnInitialized()
    {
        Brain.LoadFromFile();
        
        if (SkillName == "Programming")
        {
            CurrentXp = Brain.ProgrammingXp;
            Level = Brain.ProgrammingLevel;
            Streak = Brain.ProgrammingStreak;
        }
        else if (SkillName == "Physical Activity")
        {
            CurrentXp = Brain.GymXp;
            Level = Brain.GymLevel;
            Streak = Brain.GymStreak;
        }
        else if (SkillName == "Languages")
        {
            CurrentXp = Brain.LanguagesXp;
            Level = Brain.LanguagesLevel;
            Streak = Brain.LanguagesLevel;
        }

        _threshold = (int)Math.Pow(1.2, Level) * 100;
    }

    private void SaveToBrain()
    {
        if (SkillName == "Programming")
        {
            Brain.ProgrammingXp = CurrentXp;
            Brain.ProgrammingLevel = Level;
            Brain.ProgrammingStreak = Streak;
        }
        else if (SkillName == "Physical Activity")
        {
            Brain.GymXp = CurrentXp;
            Brain.GymLevel = Level;
            Brain.GymStreak = Streak;
        }
        else if (SkillName == "Languages")
        {
            Brain.LanguagesXp = CurrentXp;
            Brain.LanguagesLevel = Level;
            Brain.LanguagesStreak = Streak;
        }
        
        Brain.SaveToFile();
    }

    private int? _minutesSpent;
    private int _threshold = 100;

    private void AppendXp()
    {
        if (_minutesSpent == null)
            return;
        CurrentXp += (int)(2 * _minutesSpent.Value * (Streak * 0.1 + 1));
        _minutesSpent = null;
        
        SaveToBrain();
    }

    private string CanLevelUp()
    {
        if (CurrentXp >= _threshold)
            return $"is-ready {ThemeClass}";
        return "";
    }

    private void LevelUp()
    {
        if (CurrentXp < _threshold)
            return;
        CurrentXp -= _threshold;
        Level++;
        _threshold = (int)Math.Pow(1.2, Level) * 100;
        
        SaveToBrain();
    }

}

<style>
    .tracker-container {
        display: flex;
        flex-direction: column;

        flex: 1;
        padding: 40px;
        color: white;
    }
    .blue-gradient { background: radial-gradient(circle at top left, #69a8ff, #021983); }
    .red-gradient { background: radial-gradient(circle at top left, #ff4d4d, #4d0000); }
    .yellow-gradient { background: radial-gradient(circle at top left, #ffcc00, #4d3d00); }

    .skill-name {
        font-size: 42px;
        font-weight: 900;
        margin-bottom: 20px;
        background: radial-gradient(circle at top left, #454545, #5c5c5c);
        padding: 20px;
        text-align: center;
        border-radius: 8px;
    }
    .theme-blue {
        color: #009dff;
        text-shadow: 0 0 15px rgba(0, 157, 255, 0.6);
    }
    .theme-red {
        color: #ff3b3b;
        text-shadow: 0 0 15px rgba(255, 59, 59, 0.6);
    }
    .theme-yellow {
        color: #ffcc00;
        text-shadow: 0 0 15px rgba(255, 204, 0, 0.6);
    }
    
    .level-container {
        background: radial-gradient(circle at top left, #454545, #5c5c5c);
        padding: 20px;
        border-radius: 8px;
        
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .level-xp-text {
        display: flex;
        justify-content: space-between;
        align-items: baseline; 
        padding-bottom: 12px;
        text-transform: uppercase; 
    }

    .level-text {
        font-size: 28px;
        font-weight: 900;
        letter-spacing: 2px; 
    }

    .xp-text {
        font-size: 18px;
        font-weight: 700;
        color: rgba(255, 255, 255, 0.6); 
        letter-spacing: 1px;
    }
    
    .progress-track-bar {
        background-color: #2e2e2e;
        height: 40px;
        width: 100%;
        border-radius: 15px;
        box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.5);
    }

    .progress-fill-bar {
        height: 40px;
        width: 100%;
        border-radius: 15px;
        transition: width 0.4s ease-out;
    }
    
    .progress-fill-bar-blue {
        background: linear-gradient(to right, #105178, #009dff);
        box-shadow: 0 0 10px rgba(0, 157, 255, 0.4);
    }
    .progress-fill-bar-red {
        background: linear-gradient(to right, #781010, #ff0000);
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.4);
    }
    .progress-fill-bar-yellow {
        background: linear-gradient(to right, #787310, #fffb00);
        box-shadow: 0 0 10px rgba(255, 242, 0, 0.4);
    }
    
    .level-input-buttons {
        display: flex;
        gap: 15px;
        margin-top: 20px;
    }
    
    .xp-input {
        background-color: #2e2e2e;
        color: white;
        border: 2px solid #5c5c5c;
        border-radius: 8px;
        padding: 10px 15px;
        font-size: 18px;
        font-weight: 700;
        width: 130px;
        text-align: center;
        outline: none;
        box-shadow: inset 0 4px 10px rgba(0, 0, 0, 0.5);
        transition: border-color 0.3s ease;
    }
    
    .xp-input:focus {
        border-color: #ffffff;
    }

    .xp-input::-webkit-outer-spin-button,
    .xp-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .xp-input {
        -moz-appearance: textfield;
    }
    
    .append-xp-btn {
        background-color: #3a3f44;
        color: white;
        border: 2px solid #5c5c5c;
        border-radius: 8px;
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.2s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    
    .append-xp-btn:hover {
        background-color: #5c5c5c;
        border-color: #ffffff;
    }
    
    .append-xp-btn:active {
        transform: scale(0.95);
        box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
    }

    .level-up-btn {
        margin-left: auto; 
        background-color: transparent;
        color: #444444;
        border: 2px solid #444444;
        border-radius: 8px;
        padding: 10px 20px;
        font-size: 18px;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 2px;
        cursor: not-allowed; 
        
        transition: all 0.3s ease;
        box-shadow: none;
        text-shadow: none;
    }
    
    .level-up-btn.is-ready {
        cursor: pointer;
        border-color: currentColor;
        animation: pulse-level-up 2s infinite;
    }
    
    .level-up-btn.is-ready:active {
        transform: scale(0.95);
    }
    
    @@keyframes pulse-level-up {
        0% { box-shadow: 0 0 5px currentColor, inset 0 0 5px currentColor; }
        50% { box-shadow: 0 0 20px currentColor, inset 0 0 10px currentColor; }
        100% { box-shadow: 0 0 5px currentColor, inset 0 0 5px currentColor; }
    }

    .level-up-btn.theme-blue { color: #009dff; }
    .level-up-btn.theme-red { color: #ff3b3b; }
    .level-up-btn.theme-yellow { color: #ffcc00; }
</style>